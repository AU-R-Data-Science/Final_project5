---
title: "Final_Project"
author: "Shawn Yates"
date: "2022-11-14"
output: html_document
---

```{r}
library(ggplot2)
library(dplyr)
library(caret)
library(lattice)
```

```{r}
#Pi function defined as p, inverse of logit
Pi <- function(z){1/(1+exp(-z))} 

#objective function to be minimized
obj_fn <- function(beta, X, y){
  n <- length(y) # number of training examples

  p <- Pi(X%*%beta)
  J <- (t(-y)%*%log(p)-t(1-y)%*%log(1-p))/n
  J
}
```

```{r}
#gradient function
grad <- function(beta, X, y){
  n <- length(y)
  p <- Pi(X%*%beta)
  grad <- (t(X)%*%(p - y))/n
  grad
}
```

```{r}
beta_hat <- function(X, y){
  #remove NA rows
  temp <- na.omit(cbind(y, X))
  #add bias term and convert to matrix
  X <- mutate(temp[, -1], bias =1)
  X <- as.matrix(X[,c(ncol(X), 1:(ncol(X)-1))])
  y <- as.matrix(temp[, 1])
  #initialize beta
  beta <- matrix(rep(0, ncol(X)), nrow = ncol(X))
  #use the optim function to perform gradient descent
  obj_fnOpti <- optim(matrix(rep(0, 4), nrow = 4), obj_fn, grad, X=X, y=y)
  #return coefficients
  return(obj_fnOpti$par)
}
```
##### Training our model with our generated dataset
```{r}
set.seed(8)
y <- sample(c(0,1), size = 20, replace = TRUE)
n <- length(y)
x1 <- rpois(n, lambda = 3)
x2 <- rnorm(n, -3, 5)
x3 <- rexp(n, rate = 2)
int <- rep(1, n)
X <- cbind(x1, x2, x3)
data <- data.frame(y, X)
data.X <- data[, -1]
data.y <- data[, 1]
```

```{r}
model <- beta_hat(data.X, data.y)
model
```
The first number is the intercept. The next three numbers are the coefficient of for `x1, x2`  and  `x3`. These describe their log odds.


##### Comparing our self-built model with `glm()` function.
```{r}
true.model <- glm(y ~ x1 + x2 + x3, family=binomial(link ="logit"), data = data)
summary(true.model)$coefficients
```
##### Prediction function.
```{r}
bhat.predict <- function(model, X){
  X <- na.omit(X)
  #add bias term and convert to matrix
  X <- mutate(X, bias =1)
  X <- as.matrix(X[,c(ncol(X), 1:(ncol(X)-1))])
  return(Pi(X%*%model))
}
```

##### Function for the confusion matrix
```{r}
confM <- function(X, Y){
  y.prediction <- bhat.predict(model, X)
  glm.pred = rep ("0",length(Y))
  glm.pred[y.prediction > 0.5]="1"
  gpp <- factor(glm.pred)
  newy <- factor(Y)
 return(confusionMatrix(data = gpp, reference = newy)) 
}
```

#####  Test data.
```{r}
set.seed(51)
n = length(y)
newdata <- data.frame(x1 =rpois(n,lambda = 3), x2 =runif(n,-1, 1), x3 = rexp(n, rate= 5) )
newy <- sample(c(0,1), size = n, replace = TRUE)
```

##### Outputs from the confusion matrix
```{r}
conf.mat <- confM(newdata,newy)
paste("False Discovery Rate is", conf.mat$table[1,2]/(conf.mat$table[1,1] + conf.mat$table[1,2]))
paste("Diagnositic odds Ratio is", (conf.mat$table[1,1]*conf.mat$table[2,2])/(conf.mat$table[1,2]*conf.mat$table[2,1]))
conf.mat
```




